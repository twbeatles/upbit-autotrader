# Upbit Pro Algo-Trader v2.7

업비트 OpenAPI 기반 24시간 코인 자동매매 프로그램

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![PyQt6](https://img.shields.io/badge/PyQt6-6.0+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

---

## ✨ 주요 기능

### 🔥 트레이딩 전략
- **변동성 돌파 전략**: 래리 윌리엄스 전략 기반, 전일 변동폭 × K값으로 목표가 계산
- **MA5 추세 필터**: 5봉 이동평균선 위에서만 매수 진입
- **RSI 과매수 필터**: RSI 상한선 초과 시 진입 방지
- **MACD 골든크로스 필터**: MACD > Signal 일 때만 매수 (상승 모멘텀 확인)
- **거래량 필터**: 평균 거래량 대비 충분한 거래량 확인
- **트레일링 스톱**: 고점 대비 하락 시 자동 이익 실현
- **손절 기능**: 설정 손실률 초과 시 자동 손절 매도

### ⚡ 일괄 매도/매수 기능 (v2.6 신규)
- **일괄 매도**: 보유 중인 모든 코인을 현재가로 즉시 매도
- **일괄 매수**: 입력된 코인들을 균등 분배하여 현재가 매수
- **2중 확인 다이얼로그**: 실수 방지를 위한 안전 장치
- **자동매매 연계**: 일괄 작업 완료 후 알고리즘 매매 자동 시작 옵션

### 📊 고급 기술적 분석
- **MACD**: 12, 26, 9 기본값으로 모멘텀 분석
- **RSI**: 14일 기준 과매수/과매도 판단
- **스토캐스틱 RSI**: 정밀한 과매수/과매도 판단
- **DMI/ADX**: 추세 강도 및 방향 분석
- **볼린저 밴드**: 20일, 2σ 변동성 분석
- **ATR**: 동적 손절/익절 설정용

### 🧮 진입 스코어링 시스템
- 가중치 기반 0~100점 진입 점수 계산
- 목표가 돌파, MA 필터, RSI, MACD, 거래량, 볼린저밴드 종합 평가
- 설정된 임계점(기본 60점) 이상일 때만 진입하여 **거짓 돌파** 방지

### 🎛️ 프리셋 관리 시스템
- **기본 프리셋**: 공격적 / 표준 / 보수적 선택
- **사용자 프리셋**: 현재 설정을 저장하고 언제든 불러오기
- **프리셋 관리**: 생성 / 편집 / 삭제 다이얼로그

### 📝 거래 히스토리 및 분석
- **거래 내역 탭**: 모든 매수/매도 기록 자동 저장
- **CSV 내보내기**: 거래 기록 파일 다운로드
- **분석 리포트**: 승률, 누적 수익률, 손익비 시각화

### 🖥️ 시스템 트레이 통합
- **트레이 최소화**: 닫기 버튼 클릭 시 트레이로 이동
- **트레이 메뉴**: 표시/숨기기, 매매 시작/중지, 종료
- **트레이 알림**: 거래 체결 시 데스크톱 알림

### 💡 UI/UX
- **맑은고딕 폰트**: 깔끔한 한글 표시
- **스크롤 UI**: 전체 화면 스크롤 지원
- **반응형 레이아웃**: 창 최대화 시 깨짐 없음
- **다크 테마**: 눈에 편한 다크 모드
- **로그 메모리 관리**: 500줄 자동 정리

---

## 📋 요구사항

```
Python >= 3.10
PyQt6 >= 6.0
pyupbit >= 0.2.30
pandas
```

---

## 🚀 설치 및 실행

### 방법 1: 실행 파일 다운로드 (권장)
1. `dist` 폴더의 `UpbitTrader.exe` 다운로드
2. 실행 (별도 설치 불필요)
3. `upbit_settings.json`이 자동 생성됩니다.

### 방법 2: 소스코드로 실행
```bash
# 1. 의존성 설치
pip install -r requirements.txt

# 2. 실행
python upbit_trader.py
```

### 3. 초기 설정 (공통)
1. **API 키 입력**: 업비트 [Open API 관리](https://upbit.com/mypage/open_api_management)에서 발급받은 Access/Secret Key 입력
   - **필수 권한**: 자산조회, 주문조회, 주문하기 (출금 권한 불필요)
2. **System 접속**: "🔌 시스템 접속" 버튼 클릭 → "API 연결 성공" 메시지 확인
3. **코인 선택**: 거래할 코인 입력 (예: `KRW-BTC,KRW-ETH`)

---

## 📖 v2.7 신규 기능 활용 가이드

### 1. 📊 거래 분석 및 백테스트
상단 메뉴의 **[도구]** 탭을 활용하세요.
- **거래 분석 리포트**: 현재까지의 거래 기록(`trade_history.json`)을 분석하여 승률, 손익비, 누적 수익률 등을 HTML 그래프로 보여줍니다.
- **백테스트 실행**: 현재 선택된 코인에 대해 과거 200일 데이터를 기반으로 전략(변동성 돌파)을 시뮬레이션합니다.
- **내보내기**: 거래 내역을 엑셀에서 볼 수 있는 CSV 파일로 저장합니다.

### 2. 💰 분할 익절 전략
수익 보존을 위해 단계별로 매도하는 기능입니다.
1. **설정**: [전략 설정] 탭 > [리스크 관리] 그룹
2. **활성화**: "분할 익절 사용" 체크박스 선택
3. **로직**:
   - 3% 수익 시: 보유량의 30% 매도
   - 5% 수익 시: 보유량의 30% 매도
   - 8% 수익 시: 보유량의 20% 매도
   - 나머지: 트레일링 스톱 또는 목표가 매도

### 3. 🛡️ 진입 점수 시스템
단순 돌파 매매의 승률을 높이기 위해 여러 지표를 종합하여 점수(0~100점)를 매깁니다.
- **기준 점수**: 60점 이상일 때만 매수 진입 (기본값)
- **평가 항목**: 이동평균선(MA5) 추세, RSI 최적 구간, MACD 상승세, 거래량 증가, 볼린저 밴드 위치 등

---

## ⚙️ 권장 설정 가이드

### 초보자 (안정성 중시)
- **프리셋**: "🛡️ 보수적" 클릭
- **분할 익절**: ✅ 사용함
- **자금**: 종목당 5% 투자, 일일 최대 손실 3% 제한

### 경험자 (수익성 중시)
- **프리셋**: "⚖️ 표준" 클릭
- **K값**: 0.4 ~ 0.5 (변동성 민감도)
- **트레일링 스톱**: 3% ~ 5% 발동

| 항목 | 기본값 | 권장 범위 | 설명 |
|------|--------|-----------|------|
| 캔들 간격 | 4시간 | 1시간~일봉 | 변동성 계산 기준 |
| K값 | 0.4 | 0.3~0.5 | 변동성 돌파 계수 |
| 투자비중 | 10% | 5%~20% | 종목당 투자 비율 |
| TS 발동 | 5% | 3%~10% | 트레일링 시작 수익률 |
| 손절률 | 3% | 2%~5% | 강제 손절 기준 |

---

## ❓ 트러블슈팅 (FAQ)

**Q: 실행 시 `ModuleNotFoundError: No module named 'jaraco'` 오류가 납니다.**  
A: 최신 v2.7 빌드 버전을 사용하거나, `pip install jaraco.text jaraco.classes jaraco.context jaraco.functools`를 실행하여 모듈을 직접 설치해주세요.

**Q: 빌드 중 "경로를 찾을 수 없음" 오류가 뜹니다.**  
A: 프로젝트 경로에 한글이 포함된 경우(`업비트 자동매매`) PyInstaller 버그로 빌드가 실패할 수 있습니다. `C:\UpbitTrader` 처럼 영문 경로로 옮겨서 시도해보세요.

**Q: API 키 보안은 안전한가요?**  
A: API 키는 여러분의 PC (`upbit_settings.json`)에만 저장되며 외부 서버로 전송되지 않습니다.

---

## 📝 변경 이력

### v2.7 (2026-01-15)
- ✨ 확장 모듈 통합 (분석 리포트, 백테스트, 고급 지표)
- ✨ 분할 익절 기능 (3%/5%/8% 단계별 자동 매도)
- ✨ 진입 점수 시스템 적용 (60점 이상시 진입)
- ✨ 도구 메뉴 추가 (거래 분석, 백테스트, CSV 내보내기)
- 🛠️ 체결 확인 타임아웃 (60초) 추가
- 🛠️ API 키 자동 저장/로드
- 🛠️ 종료 시 설정 자동 저장
- 🛠️ 일일 통계 자정 자동 초기화

### v2.6 (2025-12-23)
- ✨ 일괄 매도/매수 기능 추가
- ✨ 2중 확인 다이얼로그 (안전 장치)
- ✨ 완료 후 자동매매 시작 옵션

### v2.5 (2025-12-23)
- ✨ 거래 히스토리 탭 및 거래 기록 관리
- ✨ 스토캐스틱 RSI, DMI/ADX 지표 추가
- ✨ 진입 스코어링 시스템 (가중치 기반)
- ✨ API 호출 재시도 로직
- 🛠️ 로그 메모리 관리 개선 (500줄 제한)
- 🛠️ 안정성 및 에러 처리 강화

### v2.0 (2025-12-19)
- ✨ MACD/거래량/볼린저밴드/ATR 지표
- ✨ 프리셋 관리, 시스템 트레이, 인앱 도움말
- 🎨 스크롤 UI, 반응형 레이아웃
- 🎨 맑은고딕 폰트, 다크 테마 개선

### v1.0
- 초기 버전 (변동성 돌파 + MA5/RSI)
