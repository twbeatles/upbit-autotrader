# Upbit Pro Algo-Trader v3.0

업비트 OpenAPI 기반 24시간 코인 자동매매 프로그램

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![PyQt6](https://img.shields.io/badge/PyQt6-6.0+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

---

## ✨ 주요 기능

### 🔥 트레이딩 전략
- **변동성 돌파 전략**: 래리 윌리엄스 전략 기반, 전일 변동폭 × K값으로 목표가 계산
- **MA5 추세 필터**: 5봉 이동평균선 위에서만 매수 진입
- **RSI 과매수 필터**: RSI 상한선 초과 시 진입 방지
- **MACD 골든크로스 필터**: MACD > Signal 일 때만 매수
- **거래량 필터**: 평균 거래량 대비 충분한 거래량 확인
- **트레일링 스톱**: 고점 대비 하락 시 자동 이익 실현
- **손절 기능**: 설정 손실률 초과 시 자동 손절 매도

### 🚀 v3.0 신규 기능

#### 고급 리스크 관리
| 기능 | 설명 |
|------|------|
| **재진입 쿨다운** | 매도 후 N분간 동일 코인 재매수 방지 (휩쏘 방어) |
| **시간 기반 청산** | N시간 보유 초과 시 자동 청산 |
| **동적 포지션 사이징** | Anti-Martingale: 연속 이익 시 확대, 연속 손실 시 축소 |

#### 고급 알고리즘
| 기능 | 설명 |
|------|------|
| **다중 시간프레임(MTF)** | 일봉과 단기봉 추세 일치 시에만 매수 |
| **갭 분석** | 갭업 시 K값 축소(신중), 갭다운 시 K값 확대(적극) |
| **돌파 확인** | 목표가 돌파 후 N틱 유지되어야 매수 |
| **긴급 전량 청산** | 모든 보유 코인을 즉시 시장가 매도 |

#### 코드 모듈화
```
upbit_trader.py      → 메인 UI + 트레이딩
upbit_config.py      → 설정 상수 (NEW)
upbit_strategy.py    → 전략 로직 (NEW)
upbit_dialogs.py     → UI 다이얼로그 (NEW)
```

### ⚡ 일괄 매도/매수 기능
- **일괄 매도**: 보유 중인 모든 코인을 현재가로 즉시 매도
- **일괄 매수**: 입력된 코인들을 균등 분배하여 현재가 매수
- **2중 확인 다이얼로그**: 실수 방지를 위한 안전 장치
- **자동매매 연계**: 일괄 작업 완료 후 알고리즘 매매 자동 시작 옵션

### 📊 기술적 분석
- **MACD**: 12, 26, 9 기본값으로 모멘텀 분석
- **RSI**: 14일 기준 과매수/과매도 판단
- **스토캐스틱 RSI**: 정밀한 과매수/과매도 판단
- **DMI/ADX**: 추세 강도 및 방향 분석
- **볼린저 밴드**: 20일, 2σ 변동성 분석
- **ATR**: 동적 손절/익절 설정용

### 🧮 진입 스코어링 시스템
- 가중치 기반 0~100점 진입 점수 계산
- 목표가 돌파, MA 필터, RSI, MACD, 거래량, 볼린저밴드 종합 평가
- 설정된 임계점(기본 60점) 이상일 때만 진입하여 **거짓 돌파** 방지

### 🎛️ 프리셋 관리 시스템
- **기본 프리셋**: 공격적 / 표준 / 보수적 선택
- **사용자 프리셋**: 현재 설정을 저장하고 언제든 불러오기
- **프리셋 관리**: 생성 / 편집 / 삭제 다이얼로그

### 📝 거래 히스토리 및 분석
- **거래 내역 탭**: 모든 매수/매도 기록 자동 저장
- **CSV 내보내기**: 거래 기록 파일 다운로드
- **분석 리포트**: 승률, 누적 수익률, 손익비 시각화

### 🖥️ 시스템 트레이 통합
- **트레이 최소화**: 닫기 버튼 클릭 시 트레이로 이동
- **트레이 메뉴**: 표시/숨기기, 매매 시작/중지, 종료
- **트레이 알림**: 거래 체결 시 데스크톱 알림

---

## 📋 요구사항

```
Python >= 3.10
PyQt6 >= 6.0
pyupbit >= 0.2.30
pandas
numpy
```

---

## 🚀 설치 및 실행

### 방법 1: 실행 파일 다운로드 (권장)
1. `dist` 폴더의 `UpbitTrader.exe` 다운로드
2. 실행 (별도 설치 불필요)
3. `upbit_settings.json`이 자동 생성됩니다.

### 방법 2: 소스코드로 실행
```bash
# 1. 의존성 설치
pip install -r requirements.txt

# 2. 실행
python upbit_trader.py
```

### 3. 초기 설정 (공통)
1. **API 키 입력**: 업비트 [Open API 관리](https://upbit.com/mypage/open_api_management)에서 발급받은 Access/Secret Key 입력
   - **필수 권한**: 자산조회, 주문조회, 주문하기 (출금 권한 불필요)
2. **System 접속**: "🔌 시스템 접속" 버튼 클릭 → "API 연결 성공" 메시지 확인
3. **코인 선택**: 거래할 코인 입력 (예: `KRW-BTC,KRW-ETH`)

---

## 📖 v3.0 고급 기능 활용 가이드

### 1. � 고급 리스크 관리 (고급 설정 탭)

**[고급 설정] 탭 > [고급 리스크 관리] 그룹**에서 활성화:

| 체크박스 | 설명 |
|----------|------|
| ☐ 재진입 쿨다운 사용 | 매도 후 설정 시간 동안 재매수 방지 |
| ☐ 시간 기반 청산 | 설정 시간 경과 시 자동 청산 |
| ☐ 동적 포지션 사이징 | 연속 손익에 따라 투자비중 자동 조절 |

### 2. 🧠 고급 알고리즘 (고급 설정 탭)

**[고급 설정] 탭 > [고급 알고리즘] 그룹**에서 활성화:

| 체크박스 | 설명 |
|----------|------|
| ☐ 다중 시간프레임(MTF) 분석 | 일봉과 단기봉 추세 일치 확인 |
| ☐ 갭 분석 및 K값 자동 조정 | 갭에 따라 K값 자동 조절 |
| ☐ 돌파 확인 (N틱 유지) | 목표가 돌파 후 유지 확인 |

### 3. 🚨 긴급 전량 청산

**[고급 설정] 탭 > [긴급 조치] 그룹**의 **[🚨 전량 긴급 청산]** 버튼:

1. 클릭 시 보유 코인 목록과 수익률 표시
2. 확인 체크박스 선택 필수
3. [긴급 청산 실행] 클릭 → 모든 보유 코인 시장가 매도

### 4. � 분할 익절 전략

**[고급 설정] 탭 > [리스크 관리] 그룹**에서 활성화:
- 3% 수익 시: 보유량의 30% 매도
- 5% 수익 시: 보유량의 30% 매도  
- 8% 수익 시: 보유량의 20% 매도

---

## ⚙️ 권장 설정 가이드

### 초보자 (안정성 중시)
- **프리셋**: "🛡️ 보수적" 클릭
- **분할 익절**: ✅ 사용함
- **v3.0 고급 기능**: ❌ 기본 설정 권장

### 경험자 (수익성 중시)
- **프리셋**: "⚖️ 표준" 클릭
- **K값**: 0.4 ~ 0.5
- **v3.0 고급 기능**: MTF + 갭 분석 권장

| 항목 | 기본값 | 권장 범위 | 설명 |
|------|--------|-----------|------|
| 캔들 간격 | 4시간 | 1시간~일봉 | 변동성 계산 기준 |
| K값 | 0.4 | 0.3~0.5 | 변동성 돌파 계수 |
| 투자비중 | 10% | 5%~20% | 종목당 투자 비율 |
| TS 발동 | 5% | 3%~10% | 트레일링 시작 수익률 |
| 손절률 | 3% | 2%~5% | 강제 손절 기준 |
| 쿨다운 | 30분 | 15~60분 | 재진입 대기 시간 (v3.0) |
| 최대 보유 | 24시간 | 12~48시간 | 시간 청산 기준 (v3.0) |

---

## 📁 파일 구조 (v3.0)

```
업비트 자동매매/
├── upbit_trader.py      # 메인 UI + 트레이딩 (3,400줄+)
├── upbit_config.py      # 설정 상수 (v3.0 NEW)
├── upbit_strategy.py    # 전략 로직 (v3.0 NEW)
├── upbit_dialogs.py     # UI 다이얼로그 (v3.0 NEW)
├── upbit_indicators.py  # 고급 기술지표
├── upbit_backtester.py  # 백테스팅 엔진
├── upbit_notifiers.py   # 알림 시스템
├── upbit_analytics.py   # 거래 분석
├── upbit_settings.json  # 설정 저장 (자동 생성)
├── upbit_presets.json   # 프리셋 저장 (자동 생성)
├── trade_history.json   # 거래 내역 (자동 생성)
├── GEMINI.md            # AI 가이드
└── upbit_trader.spec    # PyInstaller 빌드
```

---

## ❓ 트러블슈팅 (FAQ)

**Q: 실행 시 `ModuleNotFoundError: No module named 'upbit_config'` 오류가 납니다.**  
A: v3.0 모듈 파일(`upbit_config.py`, `upbit_strategy.py`, `upbit_dialogs.py`)이 `upbit_trader.py`와 같은 폴더에 있어야 합니다.

**Q: v3.0 고급 기능이 보이지 않습니다.**  
A: [고급 설정] 탭에서 확인하세요. v3.0 모듈이 정상 로드되어야 UI가 표시됩니다.

**Q: API 키 보안은 안전한가요?**  
A: API 키는 여러분의 PC (`upbit_settings.json`)에만 저장되며 외부 서버로 전송되지 않습니다.

---

## 📝 변경 이력

### v3.0 (2026-02-07)
- ✨ **코드 모듈화**: config, strategy, dialogs 분리
- ✨ **고급 리스크 관리**: 재진입 쿨다운, 시간 청산, 동적 포지션
- ✨ **고급 알고리즘**: MTF 분석, 갭 분석, 돌파 확인
- ✨ **긴급 전량 청산**: 모든 보유 코인 즉시 청산 기능
- ✨ **전략 매니저**: UpbitStrategyManager 클래스 추가
- 🛠️ GEMINI.md AI 가이드 업데이트
- 🛠️ spec 파일 신규 모듈 반영

### v2.7 (2026-01-15)
- ✨ 확장 모듈 통합 (분석 리포트, 백테스트, 고급 지표)
- ✨ 분할 익절 기능 (3%/5%/8% 단계별 자동 매도)
- ✨ 진입 점수 시스템 적용 (60점 이상시 진입)
- ✨ 도구 메뉴 추가 (거래 분석, 백테스트, CSV 내보내기)

### v2.6 (2025-12-23)
- ✨ 일괄 매도/매수 기능 추가
- ✨ 2중 확인 다이얼로그 (안전 장치)

### v2.5 (2025-12-23)
- ✨ 거래 히스토리 탭 및 거래 기록 관리
- ✨ 스토캐스틱 RSI, DMI/ADX 지표 추가
- ✨ API 호출 재시도 로직

### v2.0 (2025-12-19)
- ✨ MACD/거래량/볼린저밴드/ATR 지표
- ✨ 프리셋 관리, 시스템 트레이, 인앱 도움말

### v1.0
- 초기 버전 (변동성 돌파 + MA5/RSI)
