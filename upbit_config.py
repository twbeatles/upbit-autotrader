"""
Upbit Pro Algo-Trader - 설정 모듈
v3.0 (구조 리팩토링)
"""


class Config:
    """프로그램 설정 상수"""
    
    # ========================================================================
    # 기본 코인
    # ========================================================================
    DEFAULT_COINS = "KRW-BTC,KRW-ETH,KRW-XRP"
    
    # ========================================================================
    # 전략 기본값
    # ========================================================================
    DEFAULT_BETTING_RATIO = 10.0
    DEFAULT_K_VALUE = 0.4
    DEFAULT_TS_START = 5.0
    DEFAULT_TS_STOP = 2.0
    DEFAULT_LOSS_CUT = 3.0
    
    # ========================================================================
    # 캔들 설정
    # ========================================================================
    CANDLE_INTERVALS = {
        "1분": "minute1",
        "5분": "minute5",
        "15분": "minute15",
        "30분": "minute30",
        "1시간": "minute60",
        "4시간": "minute240",
        "일봉": "day"
    }
    DEFAULT_CANDLE = "4시간"
    
    # ========================================================================
    # RSI 설정
    # ========================================================================
    DEFAULT_RSI_PERIOD = 14
    DEFAULT_RSI_UPPER = 70
    DEFAULT_USE_RSI = True
    
    # ========================================================================
    # MACD 설정
    # ========================================================================
    DEFAULT_MACD_FAST = 12
    DEFAULT_MACD_SLOW = 26
    DEFAULT_MACD_SIGNAL = 9
    DEFAULT_USE_MACD = True
    
    # ========================================================================
    # 볼린저 밴드 설정
    # ========================================================================
    DEFAULT_BB_PERIOD = 20
    DEFAULT_BB_STD = 2.0
    DEFAULT_USE_BB = False
    
    # ========================================================================
    # ATR 설정 (동적 손절용)
    # ========================================================================
    DEFAULT_ATR_PERIOD = 14
    DEFAULT_ATR_MULTIPLIER = 2.0
    DEFAULT_USE_ATR = False
    
    # ========================================================================
    # 거래량 설정
    # ========================================================================
    DEFAULT_VOLUME_MULTIPLIER = 1.5
    DEFAULT_VOLUME_PERIOD = 20
    DEFAULT_USE_VOLUME = True
    
    # ========================================================================
    # 부분 익절 설정
    # ========================================================================
    DEFAULT_PARTIAL_PROFIT_1 = 5.0
    DEFAULT_PARTIAL_RATIO_1 = 50.0
    DEFAULT_PARTIAL_PROFIT_2 = 10.0
    DEFAULT_USE_PARTIAL = False
    
    # ========================================================================
    # 리스크 관리
    # ========================================================================
    DEFAULT_MAX_DAILY_LOSS = 5.0
    DEFAULT_MAX_HOLDINGS = 5
    DEFAULT_USE_RISK_MGMT = True
    
    # 다단계 익절 설정
    PARTIAL_TAKE_PROFIT = [
        {'rate': 3.0, 'sell_ratio': 30},
        {'rate': 5.0, 'sell_ratio': 30},
        {'rate': 8.0, 'sell_ratio': 20},
    ]
    DEFAULT_USE_PARTIAL_PROFIT = False
    
    # ========================================================================
    # 진입 점수 설정 (v2.5)
    # ========================================================================
    ENTRY_SCORE_THRESHOLD = 60
    USE_ENTRY_SCORING = False
    ENTRY_WEIGHTS = {
        'target_break': 20,
        'ma_filter': 15,
        'rsi_optimal': 20,
        'macd_golden': 20,
        'volume_confirm': 15,
        'bb_position': 10,
    }
    
    # ========================================================================
    # 스토캐스틱 RSI 설정 (v2.5)
    # ========================================================================
    DEFAULT_STOCH_RSI_PERIOD = 14
    DEFAULT_STOCH_K_PERIOD = 3
    DEFAULT_STOCH_D_PERIOD = 3
    DEFAULT_USE_STOCH_RSI = False
    
    # ========================================================================
    # DMI/ADX 설정 (v2.5)
    # ========================================================================
    DEFAULT_DMI_PERIOD = 14
    DEFAULT_ADX_THRESHOLD = 25
    DEFAULT_USE_DMI = False
    
    # ========================================================================
    # 고급 리스크 관리 (v3.0 신규)
    # ========================================================================
    # 재진입 쿨다운
    DEFAULT_COOLDOWN_MINUTES = 30
    DEFAULT_USE_COOLDOWN = False
    
    # 시간 기반 청산
    DEFAULT_MAX_HOLDING_HOURS = 24
    DEFAULT_USE_TIME_EXIT = False
    
    # 동적 포지션 사이징 (Anti-Martingale)
    DEFAULT_USE_DYNAMIC_POSITION = False
    DYNAMIC_POSITION_LOSS_THRESHOLD = 3  # 연속 N회 손실 시 축소
    DYNAMIC_POSITION_WIN_THRESHOLD = 3   # 연속 N회 이익 시 확대
    DYNAMIC_POSITION_LOSS_RATIO = 0.5    # 손실 시 축소 비율
    DYNAMIC_POSITION_WIN_RATIO = 1.5     # 이익 시 확대 비율
    DYNAMIC_POSITION_MAX_RATIO = 20.0    # 최대 투자 비율
    
    # 돌파 확인 (N틱 유지)
    DEFAULT_BREAKOUT_CONFIRM_TICKS = 3
    DEFAULT_USE_BREAKOUT_CONFIRM = False
    
    # MTF (다중 시간프레임)
    DEFAULT_USE_MTF = False
    MTF_SHORT_INTERVAL = "minute60"
    MTF_LONG_INTERVAL = "day"
    
    # 갭 분석
    DEFAULT_USE_GAP_ANALYSIS = False
    GAP_UP_K_ADJUST = 0.8    # 갭업 시 K값 축소 (신중)
    GAP_DOWN_K_ADJUST = 1.2  # 갭다운 시 K값 확대 (적극)
    GAP_THRESHOLD = 2.0      # 갭 비율 임계값 (%)
    
    # ========================================================================
    # 파일 경로
    # ========================================================================
    SETTINGS_FILE = "upbit_settings.json"
    PRESETS_FILE = "upbit_presets.json"
    TRADE_HISTORY_FILE = "trade_history.json"
    LOG_DIR = "logs"
    
    # ========================================================================
    # 시스템 설정
    # ========================================================================
    PRICE_UPDATE_INTERVAL = 1
    API_MAX_RETRIES = 3
    API_RETRY_DELAY = 1
    MAX_LOG_LINES = 500
    
    # ========================================================================
    # 기본 프리셋 정의
    # ========================================================================
    DEFAULT_PRESETS = {
        "aggressive": {
            "name": "🔥 공격적",
            "description": "높은 수익을 추구하지만 리스크도 높음",
            "k": 0.5, "ts_start": 3.0, "ts_stop": 1.5, "loss": 5.0,
            "betting": 15.0, "rsi_upper": 75, "max_holdings": 7
        },
        "normal": {
            "name": "⚖️ 표준",
            "description": "균형 잡힌 수익과 리스크 관리",
            "k": 0.4, "ts_start": 5.0, "ts_stop": 2.0, "loss": 3.0,
            "betting": 10.0, "rsi_upper": 70, "max_holdings": 5
        },
        "conservative": {
            "name": "🛡️ 보수적",
            "description": "안정적인 수익, 낮은 리스크",
            "k": 0.3, "ts_start": 7.0, "ts_stop": 2.5, "loss": 2.0,
            "betting": 5.0, "rsi_upper": 65, "max_holdings": 3
        }
    }
    
    # ========================================================================
    # 툴팁 설명
    # ========================================================================
    TOOLTIPS = {
        "coins": "감시할 코인 목록을 콤마(,)로 구분하여 입력합니다.\n예: KRW-BTC,KRW-ETH,KRW-XRP\n\n💡 팁: 변동성이 큰 코인이 전략에 더 적합합니다.",
        "candle": "변동성 계산에 사용할 캔들 간격입니다.\n\n• 1분~30분: 단타 트레이딩 (잦은 거래)\n• 1시간~4시간: 스윙 트레이딩 (권장)\n• 일봉: 장기 트레이딩",
        "betting": "총 잔고 대비 종목당 투자 비율입니다.\n\n권장 범위: 5% ~ 20%\n⚠️ 높을수록 수익/손실 폭이 커집니다.",
        "k_value": "변동성 돌파 계수 (래리 윌리엄스 전략)\n\n목표가 = 시가 + (전일 변동폭 × K값)\n\n• 낮을수록 (0.3): 보수적, 진입 빈번\n• 높을수록 (0.6): 공격적, 진입 엄격\n\n권장: 0.3 ~ 0.5",
        "ts_start": "트레일링 스톱이 발동되는 수익률입니다.\n\n이 수익률에 도달하면 고점 추적을 시작합니다.\n권장: 3% ~ 10%",
        "ts_stop": "고점 대비 하락 허용폭입니다.\n\n고점에서 이 비율만큼 하락하면 매도합니다.\n권장: 1% ~ 3%",
        "loss_cut": "절대 손절 기준입니다.\n\n매수가 대비 이 비율만큼 하락하면 즉시 매도합니다.\n권장: 2% ~ 5%",
        "rsi": "RSI(상대강도지수)가 이 값 이상이면 과매수로 판단하여\n매수를 보류합니다.\n\n권장: 65 ~ 75",
        "rsi_period": "RSI 계산에 사용할 캔들 수입니다.\n\n일반적으로 14를 사용합니다.\n권장: 10 ~ 20",
        "volume": "평균 거래량 대비 배수입니다.\n\n현재 거래량이 평균의 이 배수 이상이어야 매수합니다.\n권장: 1.2 ~ 2.0",
        "max_loss": "하루 최대 허용 손실률입니다.\n\n이 손실에 도달하면 당일 신규 매수가 중지됩니다.\n권장: 3% ~ 10%",
        "max_holdings": "동시에 보유할 수 있는 최대 종목 수입니다.\n\n분산 투자로 리스크를 관리합니다.\n권장: 3 ~ 7개",
        "cooldown": "매도 후 재진입까지 대기 시간입니다.\n\n동일 코인 재진입 방지로 휩쏘 피해를 줄입니다.\n권장: 15 ~ 60분",
        "holding_time": "최대 보유 시간입니다.\n\n이 시간이 지나면 수익/손실 관계없이 청산합니다.\n권장: 12 ~ 48시간",
    }
    
    # ========================================================================
    # 도움말 콘텐츠
    # ========================================================================
    HELP_CONTENT = {
        "quick_start": """
## 🚀 빠른 시작 가이드

### 1단계: API 키 설정
1. [업비트 OpenAPI 관리](https://upbit.com/mypage/open_api_management) 페이지에서 API 키를 발급받습니다.
2. **주문** 권한을 포함해야 합니다.
3. Access Key와 Secret Key를 프로그램에 입력합니다.
4. "🔌 시스템 접속" 버튼을 클릭합니다.

### 2단계: 코인 선택
감시할 코인을 콤마로 구분하여 입력합니다.
예: `KRW-BTC,KRW-ETH,KRW-XRP`

### 3단계: 전략 선택
- 초보자: **보수적** 프리셋 권장
- 경험자: **표준** 프리셋으로 시작
- 고급: 직접 파라미터 조정

### 4단계: 매매 시작
"🚀 전략 분석 및 매매 시작" 버튼을 클릭합니다.
        """,
        "strategy": """
## 📈 전략 설명

### 변동성 돌파 전략
래리 윌리엄스(Larry Williams)가 개발한 단기 트레이딩 전략입니다.

**핵심 원리:**
- 전일 고가 - 전일 저가 = 변동폭
- 목표가 = 당일 시가 + (변동폭 × K값)
- 현재가가 목표가를 돌파하면 매수

### MA5 추세 필터
5봉 이동평균선 위에서만 매수하여 상승 추세를 확인합니다.

### RSI 과매수 필터
RSI가 설정값 이상이면 과매수 구간으로 판단하여 진입을 보류합니다.

### 트레일링 스톱
- 목표 수익률 도달 시 고점 추적 시작
- 고점 대비 설정 하락폭 발생 시 매도
- 수익을 보존하면서 추가 상승 여지 확보

### 손절
매수가 대비 설정 손실률 도달 시 즉시 매도하여 손실을 제한합니다.
        """,
        "faq": """
## ❓ 자주 묻는 질문

**Q: API 키는 안전한가요?**
A: API 키는 로컬에만 저장되며 외부로 전송되지 않습니다.

**Q: 프로그램을 종료해도 되나요?**
A: 프로그램 종료 시 자동매매도 중지됩니다. 24시간 운영을 원하면 프로그램을 계속 실행해야 합니다.

**Q: 손실이 발생하면 어떻게 되나요?**
A: 설정된 손절률에 따라 자동으로 매도됩니다. 일일 최대 손실에 도달하면 신규 매수가 중지됩니다.

**Q: 어떤 프리셋을 선택해야 하나요?**
A: 처음 사용자는 "보수적" 프리셋으로 시작하여 프로그램에 익숙해진 후 조정하는 것을 권장합니다.

**Q: 여러 코인을 동시에 거래할 수 있나요?**
A: 네, 콤마로 구분하여 여러 코인을 입력할 수 있습니다. 최대 보유 종목 설정으로 분산 투자가 가능합니다.
        """
    }
